# Boquila self-sovereign app 

This document explains how to run the proof of concept website with u2sso.


### Dependencies to fulfil

To run the project you need to have the following dependencies installed:

- Go version 1.22 or above
- Node.js version v18.20.4 or above
- Truffle version v5.11.5 or above
- Ganache version v7.9.1 or above
- Web3.js version v1.10.0 or above
- Solidity version v0.5.16 (solc-js) or above

### deploy contract

First run the Ganache application. The Ganache application is usually an executable and can be run in a terminal or command prompt by:

`./ganache-2.7.1-linux-x86_64.AppImage`

Now, Go to the `u2ssoContract` directory and run the following commands:

Go to `u2ssoContract` directory and deploy the contract:
``truffle compile``
``truffle test``
``truffle deploy``

This will compile, test and eventually deploy the contract on the Ganache network.

Get your contract address from Ganache, e.g., `0xFf9e0936C2d65D66E9e66d3b1467982C9bfA0e45`
and an Ethereum account private key (without `0x`), e.g., `F30290f26CE49C145cC64f2f2c722DB3298e8056`.

### Running the server

First run the server with the contract address:
``go build server.go``
``./server -contract 0xFf9e0936C2d65D66E9e66d3b1467982C9bfA0e45``

Open the webpage in a browser by visiting:

``http://localhost:8080/``

To log in or sign up, you need to run the client application first, which will generate relevant proof, spk address and the signature required to register and authenticate the user.

### Running the client

First build the client application:

``go build clientapp.go``

The project runs in multiple steps. The following are the steps to register and authenticate a user:

#### Create and store SSO-ids in the contract

``./clientapp -command create -contract 0xFf9e0936C2d65D66E9e66d3b1467982C9bfA0e45 -keypath key1.txt -ethkey F30290f26CE49C145cC64f2f2c722DB3298e8056``

Run the above command for multiple users to create multiple SSO-ids. Remember -ethkey is the private key of an Ethereum account present on Ganache network.

Now, load a passkey using which you want to authenticate the user:

``./clientapp -command load -contract 0xFf9e0936C2d65D66E9e66d3b1467982C9bfA0e45 -keypath key1.txt``

#### Register for the service

Now, webpage running on `http://localhost:8080/` is the service that allows U2SSO sign in service, you can click on Sign up button to register for the service.

At the top of the Sign up page a challenge and a service name will be displayed. Copy the challenge (`-challenge`) and service name (`-sname`) and run the following command:

``./clientapp -command register -contract 0xFf9e0936C2d65D66E9e66d3b1467982C9bfA0e45 -keypath key1.txt -sname 6d7e78af064c86eb9b9cb1c3611c9ab60a2f9317e3891891ef31770939f78ef8 -challenge b3d2482b609777d36d6faa48b3f0921f64d1d314665ab96b8d667838d2f51207``

This command along with other items will output current id size, a proof and spkBytes.

Now, fill the following Signup form fields:
- Username: Any username of your choice.
- Public key for the account: Here paste the spkBytes generated by the above command.
- Decoy size: The current id size generated by the above command.
- Nullifier: Put any value for now. Eg. 00000
- Membership Proof: The proof generated by the above command.

Upon Hitting the Submit button, you will be registered for the service. If, it throws an error then check all the field correctly and try again.

Now, with this command you can authenticate for the service.

#### Authentication for a service

Now, go back to the homepage and click on Log in button.
At the top of the page again you will see challenge and service name. Copy the challenge and service name and run the following command:

``./clientapp -command auth -contract 0xFf9e0936C2d65D66E9e66d3b1467982C9bfA0e45 -keypath key1.txt -sname 6d7e78af064c86eb9b9cb1c3611c9ab60a2f9317e3891891ef31770939f78ef8 -challenge 05a748a7c8f7b7dc02f619e56d1a909e3e364bad4a7c08ce39b164b623ab0e82``

This command will output a proof auth. Now, fill the following Log in form fields:
- Username: The username you registered with.
- Public key for the account: Here paste the spkBytes generated by the command in registration process.
- Digital Signature: The proof auth generated by the above command.

Upon hitting the Submit button, you will be logged in. If, it throws an error then check all the field correctly and try again.